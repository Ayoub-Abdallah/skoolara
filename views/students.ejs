<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KMA | Admin</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <!-- <script src="https://kit.fontawesome.com/c352df61bb.js" crossorigin="anonymous"></script> -->
    <link href="assets/style.css" rel="stylesheet" />
</head>

<body>
    <nav>
        <div class="container">
            <img src="assets/images/Massinissa.png" class="logo" />
            <div class="search-bar">
                <span class="material-icons">search</span>
                <input type="search" placeholder="Search" />
            </div>

            <div class="profile-area">
                <div class="theme-btn">
                    <span class="material-icons active">light_mode</span>
                    <span class="material-icons">dark_mode</span>
                </div>
                <div class="profile">
                    <div class="profile-photo">
                        <img src="assets/images/profile pic.jpg" />
                    </div>
                    <h5>Ayoub</h5>
                    <span class="material-icons">expand_more</span>
                </div>
                <button id="menu-btn">
                    <span class="material-icons">menu</span>
                </button>
            </div>
        </div>
    </nav>
    <!-- End of Navbar -->
    <main>
        <aside>
            <button id="close-btn">
                <span class="material-icons">close</span>
            </button>
            <div class="sidebar">
                <a href="admin">
                    <span class="material-icons">dashboard</span>
                    <h4>Dashboard</h4>
                </a>
                <a href="students" class="active">
                    <span class="material-icons">school</span>
                    <h4>Étudiants</h4>
                </a>
                <a href="teachers">
                    <span class="material-icons">person</span>
                    <h4>Enseignants</h4>
                </a>
                <a href="groups">
                    <span class="material-icons">group</span>
                    <h4>Groupes</h4>
                </a>
                <a href="classrooms">
                    <span class="material-icons">class</span>
                    <h4>Salles de classe</h4>
                </a>
                <a href="finance">
                    <span class="material-icons">attach_money</span>
                    <h4>Finance</h4>
                </a>

                <!-- <a href="attendance">
                    <span class="material-icons">check_circle</span>
                    <h4>Présence</h4>
                </a> -->
                <a href="settings">
                    <span class="material-icons">settings</span>
                    <h4>Paramètres</h4>
                </a>
            </div>
            <!-- End of sidebar -->

            <!-- <div class="updates">
                      <span class="material-icons">update</span>
                      <h4>Updates Available</h4>
                      <p>Security Updates</p>
                      <p>General Updates</p>
                      <a href="#">Update Now</a>
                  </div> -->
        </aside>
        <!-- End of aside -->
        <!-- in case of arabic: dir="rtl" -->
        <section class="middle">
            <div class=" header">
                <h1>Étudiants</h1>
            </div>
            <div class="tools">
                <div>
                    <button onclick="activateTab(0)">
                        <!-- <span class="material-icons">person_add</span> -->
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#000000">
                            <path
                                d="M720-400v-120H600v-80h120v-120h80v120h120v80H800v120h-80Zm-360-80q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm80-80h480v-32q0-11-5.5-20T580-306q-54-27-109-40.5T360-360q-56 0-111 13.5T140-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T440-640q0-33-23.5-56.5T360-720q-33 0-56.5 23.5T280-640q0 33 23.5 56.5T360-560Zm0-80Zm0 400Z" />
                        </svg>
                    </button>
                    <button class="editBtn" onclick="editStudent()">
                        <!-- <span class="material-icons">manage_accounts</span>  -->
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#000000">
                            <path
                                d="M480-240Zm-320 80v-112q0-34 17.5-62.5T224-378q62-31 126-46.5T480-440q37 0 73 4.5t72 14.5l-67 68q-20-3-39-5t-39-2q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32h240v80H160Zm400 40v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q8 9 12.5 20t4.5 22q0 11-4 22.5T903-340L683-120H560Zm300-263-37-37 37 37ZM620-180h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19ZM480-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Zm0-80Z" />
                        </svg>

                    </button>
                    <button onclick="deleteStudent()">
                        <!-- <span class="material-icons">person_remove</span> -->
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#000000">
                            <path
                                d="M640-520v-80h240v80H640Zm-280 40q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm80-80h480v-32q0-11-5.5-20T580-306q-54-27-109-40.5T360-360q-56 0-111 13.5T140-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T440-640q0-33-23.5-56.5T360-720q-33 0-56.5 23.5T280-640q0 33 23.5 56.5T360-560Zm0-80Zm0 400Z" />
                        </svg>
                    </button>
                    <!-- <form action="" class="searchFormStudent"> -->
                    <select name="category" id="category-select">
                        <!-- <option value="">Select your category</option> -->
                        <option value="name">Nom / Prénom</option>
                        <option value="group">Groupe</option>
                        <option value="phone">Téléphone</option>
                    </select>
                    <input type="search" id="search-input" placeholder="Enter your seach query...">
                    <button class="searchbutton">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#e8eaed">
                            <path
                                d="M440-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T520-640q0-33-23.5-56.5T440-720q-33 0-56.5 23.5T360-640q0 33 23.5 56.5T440-560ZM884-20 756-148q-21 12-45 20t-51 8q-75 0-127.5-52.5T480-300q0-75 52.5-127.5T660-480q75 0 127.5 52.5T840-300q0 27-8 51t-20 45L940-76l-56 56ZM660-200q42 0 71-29t29-71q0-42-29-71t-71-29q-42 0-71 29t-29 71q0 42 29 71t71 29Zm-540 40v-111q0-34 17-63t47-44q51-26 115-44t142-18q-12 18-20.5 38.5T407-359q-60 5-107 20.5T221-306q-10 5-15.5 14.5T200-271v31h207q5 22 13.5 42t20.5 38H120Zm320-480Zm-33 400Z" />
                        </svg>
                    </button>
                    <button onclick="refresh()">
                        <span class="material-icons certification" >
                            filter_alt_off
                        </span>
                    </button>
                    <!-- </form> -->
                </div>
                <div>
                    <button onclick="showCertification()">
                        <span class="material-icons certification" >
                            workspace_premium
                        </span>
                    </button>
                    <button onclick="exportExcel()">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#e8eaed">
                            <path
                                d="M360-240h440v-107H360v107ZM160-613h120v-107H160v107Zm0 187h120v-107H160v107Zm0 186h120v-107H160v107Zm200-186h440v-107H360v107Zm0-187h440v-107H360v107ZM160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Z" />
                        </svg>
                    </button>
                    <input type="checkbox" name="" id="">
                </div>
            </div>

            <table class="studentsTable">
                <tbody>
                    <tr>
                        <th></th>
                        <th>Prénom</th>
                        <th>Nom</th>
                        <!-- <th>Sex</th> -->
                        <!-- <th>Année Scolaire</th> -->
                        <th>Téléphone</th>
                        <th>Groupes</th>
                        <!-- <th>Note</th> -->
                        <th>Frais (DZD)</th>
                        <th>Présence</th>
                        <th></th>

                    </tr>
                    <% students.forEach(student=> { %>
                        <tr>
                            <td>
                                <button class="checkBox" onclick="check(event, '<%= student.student._id %>') ">
                                    &#10003;
                                    <!-- &check; -->
                                </button>
                            </td>

                            <td>
                                <%= student.student.firstname %>
                            </td>
                            <td>
                                <%= student.student.lastname%>
                            </td>
                            <!-- <td>
                                < %= student.student.sex %>
                            </td> -->
                            <!-- <td>
                                < %= student.student.schoolyear%>
                            </td> -->
                            <td>
                                <%= student.student.phone %>
                            </td>
                            <td>
                                <% student.groups.forEach(group=> { %>
                                    <%= group.name %>
                                        <% }); %>
                            </td>
                            <!-- <td>
                               < %= student.student.note %>
                            </td> -->
                            <td onclick="editPaiment('<%= student.student._id %>')" class="paimentTD">
                                <% if (!student.student.payment[0]) { %>
                                    <%= "//" %>
                                        <% } else { %>
                                            <% let total=0; student.student.payment[0].payed.forEach(element=> {
                                                total += element.value;
                                                });
                                                %>
                                                <%= total + ' / ' + student.student.payment[0].total %>
                                                    <% } %>
                            </td>
                            <td class="presencetd">
                                <button onclick="setPresence('<%= student.student._id %>')">
                                    <span class=" material-icons">calendar_month</span>
                                </button>
                            </td>
                            <td>
                                <% if(student.student.inscription) { %>
                                    <span class="material-icons dot green" 
                                    onclick="unsetInscription('<%= student.student._id %>')"
                                    >circle</span>
                                 <% } else { %>
                                    <span class="material-icons dot red"
                                    onclick="setInscription('<%= student.student._id %>')"
                                    >circle</span>
                                <% } %>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>


        </section>
        <!-- End of Middle -->

        <!-- Add Student start -->
        <form class="back-cover add_student-cover">
            <div class=" form-container add_student ">
                <h1>Ajouter Etudiant</h1>
                <div>
                    <label for="">
                        Nom
                        <input type=" text" name="lastname" id="">
                    </label>
                    <label for="">
                        Prénom
                        <input type="text" name="firstname" id="">
                    </label>
                </div>
                <div>
                    <label for="">
                        Date de naissance
                        <input type="date" name="birthdate" id="">
                    </label>
                    <label for="">
                        Lieu de naissance
                        <input type="text" name="birthplace" id="">
                    </label>
                </div>
                <div>
                    <label for="">
                        Les parents
                        <input type="text" name="parents" id="">
                    </label>
                    <label for="">
                        sexe
                        <select name="sex" id="">
                            <option value="male">Mâle</option>
                            <option value="female">Femelle</option>
                        </select>
                    </label>
                </div>
                <h2>Contact</h2>
                <div>
                    <label for="">
                        Téléphone
                        <input type="number" name="phone" id="">
                    </label>
                    <label for="">
                        Email
                        <input type="email" name="email" id="">
                    </label>
                </div>
                <div>
                    <label for="">
                        Mobile 01
                        <input type="number" name="mobile1" id="">
                    </label>
                    <label for="">
                        Mobile 02
                        <input type="number" name="mobile2" id="">
                    </label>
                </div>
                <h2>Info Academique</h2>
                <div>
                    <label for="">
                        Le groupe
                        <select name="group" class="add-student-group-select" id="">
                            <option value="">Selectionner un groupe</option>

                        </select>
                    </label>
                    <label for="">
                        Année scolaire
                        <input type="text" name="schoolyear" id="">
                    </label>
                </div>
                <h2>Info Additionelle</h2>
                <label for="">
                    Date d'inscription
                    <input type="date" name="inscriptiondate">
                </label>
                <div>
                    <label for="">
                        problèmes de santé physique
                        <input type="text" name="physicalproblem" id="">
                    </label>
                    <label for="">
                        problèmes de santé mentale
                        <input type="text" name="mentalproblems" id="">
                    </label>
                </div>
                <label for="">
                    Notes
                    <textarea type="text" name="notes"></textarea>
                </label>
                <div class="btncont">
                    <button onclick="deactivateTabs(0)" type="button">Annuler</button>
                    <button type="submit" onclick="handleAddStudent()">Enregistrer</button>
                </div>
            </div>
        </form>
        <!-- Add Student end -->
        <!-- edit student start -->

        <div class="back-cover edit_student-cover">
            <form class=" form-container add_student editStudentForm">
                <h1>Modifier détails d'étudiant</h1>
                <div>
                    <label for="">
                        Nom
                        <input class="fname" type=" text" name="lastname" id="">
                    </label>
                    <label for="">
                        Prénom
                        <input class="lname" type="text" name="firstname" id="">
                    </label>
                </div>
                <div>
                    <label for="">
                        Date de naissance
                        <input class="bd" type="date" name="birthdate" id="">
                    </label>
                    <label for="">
                        Lieu de naissance
                        <input class="bp" type="text" name="birthplace" id="">
                    </label>
                </div>
                <div>
                    <label for="">
                        Les parents
                        <input class="parents" type="text" name="parents" id="">
                    </label>
                    <label for="">
                        sexe
                        <select class="sex" name="sex" id="">
                            <option value="male">Mâle</option>
                            <option value="female">Femelle</option>
                        </select>
                    </label>
                </div>
                <h2>Contact</h2>
                <div>
                    <label for="">
                        Téléphone
                        <input class="phone" type="number" name="phone" id="">
                    </label>
                    <label for="">
                        Email
                        <input class="email" type="email" name="email" id="">
                    </label>
                </div>
                <div>
                    <label for="">
                        Mobile 01
                        <input class="mobile1" type="number" name="mobile1" id="">
                    </label>
                    <label for="">
                        Mobile 02
                        <input class="mobile2" type="number" name="mobile2" id="">
                    </label>
                </div>
                <h2>Info Academique</h2>
                <div class="groups-tags">
                    <div>
                        <label for="">
                            Les groupes
                            <select id="tagSelect" class="edit-student-group-select"></select>
                        </label>
                        <button id="addTagButton" type="button">Add Tag</button>
                    </div>
                    <div id="tagsContainer"></div>
                </div>
                <label for="">
                    Année scolaire
                    <input type="text" class="schoolYear" name="schoolyear" id="">
                </label>
                <h2>Info Additionelle</h2>
                <label for="">
                    Date d'inscription
                    <input type="date" class="dateInsc" name="inscriptiondate">
                </label>
                <div>
                    <label for="">
                        problèmes de santé physique
                        <input type="text" class="phP" name="physicalproblem" id="">
                    </label>
                    <label for="">
                        problèmes de santé mentale
                        <input type="text" class="mnP" name="mentalproblems" id="">
                    </label>
                </div>
                <label for="">
                    Notes
                    <textarea class="notes" type="text" name="notes"></textarea>
                </label>
                <div class="btncont">
                    <button onclick="deactivateTabs(0)" type="button">Annuler</button>
                    <button type="submit">Enregistrer</button>
                </div>
            </form>
        </div>

        <div class="back-cover delete_student ">
            <div class="form-container delete_student-cover">
                <h2>are you sure wanna delete this student?</h2>
                <div class="btncont">
                    <button onclick="deactivateTabs(3)" type="button">Annuler</button>
                    <button type="button" onclick="handleDelete()">Enregistrer</button>
                </div>
            </div>
        </div>

        <div class="presence-cover">
            <div class="presence-container">
                <div class="presence-header">
                    <div>
                        <h1>Présence</h1>
                        <div>
                            <h4 class="presenceFirstName"></h4>
                            <h4 class="presenceLastName"></h4>
                        </div>
                        <button class="add-presence">Ajouter</button>
                    </div>
                    <button onclick=" deactivateTabs()">Ok</button>
                </div>
                <table class="presenceTable">
                    <tr>
                        <th>Groupe</th>
                        <th>Date</th>
                        <th>temps</th>
                    </tr>
                </table>
            </div>
        </div>

        <div class="back-cover add-presence-cover">
            <form class="form-container add-presence-container">
                <h1>Ajouter Présence d'étudiant</h1>
                <h4>By Adding info student is marked as prsent in the session</h4>
                <label for="">Groupe</label>
                <select name="groupId" id="" class="presenceSelect">
                    <option value="">Choose group</option>
                </select>
                <label for="">Date</label>
                <input type="date" name="date">
                <!-- <label for="">Time</label>
                <input type="time" name="time"> -->
                <div class="btncont">
                    <button onclick="deactivateTabs(4)" type="button">Annuler</button>
                    <button type="submit">Enregistrer</button>
                </div>
            </form>
        </div>

        <div class="back-cover payment-cover">
            <div class="form-container payment-container">
                <div class="payment-header">
                    <div style="display: block;">
                        <h1>Les frais d'étude</h1>
                        <span class="pyament-student-details">
                            <h4 class="paymentFirstName"></h4>
                            <h4 class="paymentLastName"></h4>
                        </span>
                        <button class="add-payment" onclick="openForm()">Ajouter</button>
                    </div>
                    <button onclick=" deactivateTabs()">Ok</button>
                </div>
                <div class="paymentTable">

                </div>
            </div>
        </div>
        <div class="back-cover add-payment-cover">
            <form class="form-container add-payment-container">
                <h1>Ajouter Frais d'étude</h1>
                <!-- <h4>By Adding info student is marked as prsent in the session</h4> -->
                <label for="">Groupe</label>
                <select name="groupId" id="" class="paymentSelect">
                    <option value="">Choose group</option>
                </select>
                <label for="">Date</label>
                <input type="date" name="date">
                <label for="">Somme</label>
                <input type="number" name="value">
                <label for="">Total</label>
                <input type="number" name="total">
                <div class="btncont">
                    <button onclick="deactivateTabs()" type="button">Annuler</button>
                    <button type="submit">Enregistrer</button>
                </div>
            </form>
        </div>

        <div class="back-cover success-message-cover">
            <div class="form-container success-message">
                <svg xmlns="http://www.w3.org/2000/svg" height="100px" viewBox="0 -960 960 960" width="24px"
                    fill="#e8eaed">
                    <path
                        d="m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
                </svg>
                <h2>Student created successfully!</h2>
                <div>
                    <button onclick="refresh()">Ok</button>
                </div>
            </div>
        </div>

        <div class="back-cover certification-cover">
            <form id="certification-form" class="form-container certification-form"
             enctype="multipart/form-data" onsubmit="handleCertification(event)">
                <h1>Créer des certifications</h1>
                <label for="template">Upload Word Template:</label>
                <input type="file" name="template" id="template" required>
                <div>
                    <button type="button" onclick="deactivateTabs()">Annuler</button>
                    <button type="submit">Créer</button>
                </div>
            </form>
        </div>
        <!-- edit student end-->
        <!-- End of right -->
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"
        integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="assets/main.js"></script>
    <script src="assets/studentPageController.js"></script>
    <script src="assets/fetchController.js"></script>

    <!-- End of Main -->
</body>

</html>